<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.21">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Constance Streitman">

<title>Package Delay Report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Package Delay Report_files/libs/clipboard/clipboard.min.js"></script>
<script src="Package Delay Report_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Package Delay Report_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Package Delay Report_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="Package Delay Report_files/libs/quarto-html/popper.min.js"></script>
<script src="Package Delay Report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Package Delay Report_files/libs/quarto-html/anchor.min.js"></script>
<link href="Package Delay Report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Package Delay Report_files/libs/quarto-html/quarto-syntax-highlighting-ea1d7ac60288e0f1efdbc993fd8432ae.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Package Delay Report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Package Delay Report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Package Delay Report_files/libs/bootstrap/bootstrap-9e3ffae467580fdb927a41352e75a2e0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Package Delay Report</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Constance Streitman </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>I chose the dataset off of Kaggle, published in August by Shahriar Kabir and titled “US Logistics Performance Dataset:Simulated Shipment Data for Cost Reduction &amp; Delivery Reliability”. This was for a class project, and I browsed through Kaggle simply looking for something business-related that had an easy problem to answer. After seeing the “Status” column for this one, I knew this would be the one.</p>
<p>Thus, I set out to answer the question of inferring what variables affect package status, or in other words, what factors indicate a package will end up delayed or lost instead of it arriving on-time.</p>
</section>
<section id="data-cleaning-pre-processing" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning-pre-processing">Data, cleaning &amp; pre-processing</h2>
<p>At first, there were 2,000 samples and 9 predictors. 3 were categorical, 3 were numeric, and 3 were in a strange limbo of uselessness. The three limbo values were the shipment ID, the shipment date, and the delivery date. I removed the shipment ID, and a peer used the shipment date and delivery date to find the amount of days spent in transit (need to include in report, but shall hide).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">subset</span>(df, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Shipment_ID))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Also, we removed some samples from the data set, namely, packages that were “In Transit” as opposed to delayed, delivered, or lost. Their final outcome had yet to be known, so it was overall useless for inference in this matter. Then, I made a binary between “Delayed or Lost” and “Delivered” to use later for logistic regression and to make the confusion matrix simpler.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">subset</span>(df, <span class="fu">tolower</span>(Status) <span class="sc">!=</span> <span class="st">"in transit"</span>) <span class="co">#deleting "in transit" samples</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>D_or_L <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">tolower</span>(df<span class="sc">$</span>Status) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"delayed"</span>, <span class="st">"lost"</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ^ makes the binary</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">subset</span>(df, <span class="at">select =</span> <span class="sc">-</span>Status)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Next, I fixed the issue of there being N/A values present under the cost predictor. I planned to just replace it with the mean or median, but I couldn’t even tell what I was supposed to do due to the extreme outliers skewing the visibility of the cost histogram. So, I removed the outliers and tested cost for normality before I could proceed.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df<span class="sc">$</span>Cost)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Package-Delay-Report_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Q1 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(df<span class="sc">$</span>Cost, <span class="fl">0.25</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Q3 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(df<span class="sc">$</span>Cost, <span class="fl">0.75</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>IQR <span class="ot">&lt;-</span> Q3 <span class="sc">-</span> Q1</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> Q1 <span class="sc">-</span> <span class="fl">1.5</span> <span class="sc">*</span> IQR</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> Q3 <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> IQR</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>df_no_outliers <span class="ot">&lt;-</span> <span class="fu">subset</span>(df, Cost <span class="sc">&gt;=</span> lower <span class="sc">&amp;</span> Cost <span class="sc">&lt;=</span> upper)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(df_no_outliers<span class="sc">$</span>Cost)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Package-Delay-Report_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(df_no_outliers<span class="sc">$</span>Cost)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  df_no_outliers$Cost
W = 0.97874, p-value = 4.232e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Cost[<span class="fu">is.na</span>(df<span class="sc">$</span>Cost)] <span class="ot">=</span> <span class="fu">median</span>(df<span class="sc">$</span>Cost, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Seeing that the data was non-normal, I replaced the N/A values with the Cost median.</p>
<p>Then, I added the Weekday value, which took the date of shipment and said what day of the week it was. I was curious if packages shipped on Fridays or Mondays had different outcomes, and wanted to test it.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Delivery_Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(df<span class="sc">$</span>Delivery_Date, <span class="at">origin =</span> <span class="st">"1970-01-01"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Shipment_Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(df<span class="sc">$</span>Shipment_Date, <span class="at">origin =</span> <span class="st">"1970-01-01"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>ShipWeekday <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">weekdays</span>(df<span class="sc">$</span>Shipment_Date, <span class="at">abbreviate =</span> <span class="cn">FALSE</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Monday"</span>,<span class="st">"Tuesday"</span>,<span class="st">"Wednesday"</span>,<span class="st">"Thursday"</span>,<span class="st">"Friday"</span>,<span class="st">"Saturday"</span>,<span class="st">"Sunday"</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ordered =</span> <span class="cn">FALSE</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Then, I reordered the columns to be more contiguous—“Delayed or Lost” in the first column, with categorical variables all in one spot, then the dates, and then all the numeric variables.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[, <span class="fu">c</span>(<span class="st">"D_or_L"</span>, <span class="st">"Origin_Warehouse"</span>, <span class="st">"Destination"</span>, </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Carrier"</span>, <span class="st">"ShipWeekday"</span>, <span class="st">"Shipment_Date"</span>, <span class="st">"Delivery_Date"</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Transit_Days"</span>, <span class="st">"Distance_miles"</span>, <span class="st">"Weight_kg"</span>, <span class="st">"Cost"</span>)]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="principal-component-analysis-pca" class="level2">
<h2 class="anchored" data-anchor-id="principal-component-analysis-pca">Principal Component Analysis (PCA)</h2>
<p>I separated out the numeric components, and then ran PCA to see if I could reduce dimensionality somehow, or just to see what was there. This showed that Transit Days, Cost, and Distance were all part of the first dimension, which represented 41% of the variability of the numeric-only model, followed by Weight, which represented another 25%.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dfnumeric <span class="ot">=</span> df[<span class="dv">8</span><span class="sc">:</span><span class="dv">11</span>]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>pc_result <span class="ot">=</span> <span class="fu">prcomp</span>(dfnumeric, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">PCA</span>(dfnumeric, <span class="at">scale=</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Package-Delay-Report_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Package-Delay-Report_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>**Results for the Principal Component Analysis (PCA)**
The analysis was performed on 1924 individuals, described by 4 variables
*The results are available in the following objects:

   name               description                          
1  "$eig"             "eigenvalues"                        
2  "$var"             "results for the variables"          
3  "$var$coord"       "coord. for the variables"           
4  "$var$cor"         "correlations variables - dimensions"
5  "$var$cos2"        "cos2 for the variables"             
6  "$var$contrib"     "contributions of the variables"     
7  "$ind"             "results for the individuals"        
8  "$ind$coord"       "coord. for the individuals"         
9  "$ind$cos2"        "cos2 for the individuals"           
10 "$ind$contrib"     "contributions of the individuals"   
11 "$call"            "summary statistics"                 
12 "$call$centre"     "mean of the variables"              
13 "$call$ecart.type" "standard error of the variables"    
14 "$call$row.w"      "weights for the individuals"        
15 "$call$col.w"      "weights for the variables"          </code></pre>
</div>
</div>
<p>The PCA was just to look around, though, not to find anything significant.</p>
</section>
<section id="logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression">Logistic Regression</h2>
<p>So, first I made a logistic regression of the categorical variables only, to see if anything came out significant.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Shipment_Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(df<span class="sc">$</span>Shipment_Date, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>) <span class="co">#idk</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="do">##########################################################</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="do">####LOGISIC REGRESSION</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>CatReg <span class="ot">&lt;-</span> <span class="fu">glm</span>(D_or_L <span class="sc">~</span> Origin_Warehouse <span class="sc">+</span> Destination <span class="sc">+</span> Carrier <span class="sc">+</span> ShipWeekday,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> df, <span class="at">family =</span> binomial)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CatReg) <span class="co">#NOTE: WArehouse_NYC and Boston have pval low. Also UPS. but</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = D_or_L ~ Origin_Warehouse + Destination + Carrier + 
    ShipWeekday, family = binomial, data = df)

Coefficients:
                               Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                   -2.107698   0.446388  -4.722 2.34e-06 ***
Origin_WarehouseWarehouse_BOS -0.240388   0.300844  -0.799   0.4243    
Origin_WarehouseWarehouse_CHI -0.297000   0.300163  -0.989   0.3224    
Origin_WarehouseWarehouse_DEN -0.447186   0.311175  -1.437   0.1507    
Origin_WarehouseWarehouse_HOU -0.060485   0.282164  -0.214   0.8303    
Origin_WarehouseWarehouse_LA  -0.254328   0.291911  -0.871   0.3836    
Origin_WarehouseWarehouse_MIA  0.001891   0.285960   0.007   0.9947    
Origin_WarehouseWarehouse_NYC -0.722665   0.353078  -2.047   0.0407 *  
Origin_WarehouseWarehouse_SEA -0.496021   0.316620  -1.567   0.1172    
Origin_WarehouseWarehouse_SF  -0.130943   0.282588  -0.463   0.6431    
DestinationBoston              0.920077   0.398338   2.310   0.0209 *  
DestinationChicago             0.207933   0.415892   0.500   0.6171    
DestinationDallas              0.307388   0.423575   0.726   0.4680    
DestinationDenver              0.241659   0.426214   0.567   0.5707    
DestinationDetroit             0.732620   0.393884   1.860   0.0629 .  
DestinationHouston             0.452529   0.423549   1.068   0.2853    
DestinationLos Angeles         0.417138   0.422710   0.987   0.3237    
DestinationMiami               0.102510   0.450699   0.227   0.8201    
DestinationMinneapolis         0.389828   0.407613   0.956   0.3389    
DestinationNew York            0.688170   0.410897   1.675   0.0940 .  
DestinationPhoenix             0.457846   0.404243   1.133   0.2574    
DestinationPortland            0.383512   0.411888   0.931   0.3518    
DestinationSan Francisco       0.392939   0.422206   0.931   0.3520    
DestinationSeattle             0.583731   0.424817   1.374   0.1694    
CarrierDHL                    -0.219749   0.241110  -0.911   0.3621    
CarrierFedEx                  -0.463487   0.252928  -1.832   0.0669 .  
CarrierLaserShip              -0.404738   0.244402  -1.656   0.0977 .  
CarrierOnTrac                 -0.465785   0.249498  -1.867   0.0619 .  
CarrierUPS                    -0.653647   0.273248  -2.392   0.0168 *  
CarrierUSPS                   -0.414563   0.250059  -1.658   0.0973 .  
ShipWeekdayTuesday             0.635491   0.270873   2.346   0.0190 *  
ShipWeekdayWednesday           0.238237   0.280683   0.849   0.3960    
ShipWeekdayThursday            0.206236   0.292609   0.705   0.4809    
ShipWeekdayFriday              0.530619   0.272265   1.949   0.0513 .  
ShipWeekdaySaturday            0.356407   0.279808   1.274   0.2028    
ShipWeekdaySunday              0.338133   0.286847   1.179   0.2385    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1463.4  on 1923  degrees of freedom
Residual deviance: 1425.8  on 1888  degrees of freedom
AIC: 1497.8

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>The NYC warehouse, Boston as a destination, and the carrier UPS all seemed significant, but with a model this crowded it was strange and hard to tell just what was going on. To confirm, I ran some tests below (with some pre-processing to match), but was still left confused.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>uglydf <span class="ot">=</span> df <span class="co">#so df isnt polluted by bs columns</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted probabilities</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">augment</span>(CatReg, <span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">newdata =</span> df)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>uglydf<span class="sc">$</span>pred_prob <span class="ot">&lt;-</span> preds<span class="sc">$</span>.fitted</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># average predicted prob by destination</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>uglydf <span class="sc">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Destination) <span class="sc">%&gt;%</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_delay_prob =</span> <span class="fu">mean</span>(pred_prob))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 2
   Destination   mean_delay_prob
   &lt;fct&gt;                   &lt;dbl&gt;
 1 Atlanta                0.0840
 2 Boston                 0.196 
 3 Chicago                0.108 
 4 Dallas                 0.114 
 5 Denver                 0.102 
 6 Detroit                0.170 
 7 Houston                0.125 
 8 Los Angeles            0.125 
 9 Miami                  0.0932
10 Minneapolis            0.126 
11 New York               0.158 
12 Phoenix                0.135 
13 Portland               0.118 
14 San Francisco          0.122 
15 Seattle                0.142 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### HOW LIKELY IT IS TO GET DELAY/LOST IN EACH DESTINATION LOCATION!!!</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#low is 8%, high is 20% (Boston)</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># average predicted prob by WAREHOUSE!!!!!!!!!!</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>uglydf <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Origin_Warehouse) <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_delay_prob =</span> <span class="fu">mean</span>(pred_prob))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   Origin_Warehouse mean_delay_prob
   &lt;fct&gt;                      &lt;dbl&gt;
 1 Warehouse_ATL             0.157 
 2 Warehouse_BOS             0.124 
 3 Warehouse_CHI             0.119 
 4 Warehouse_DEN             0.106 
 5 Warehouse_HOU             0.146 
 6 Warehouse_LA              0.124 
 7 Warehouse_MIA             0.153 
 8 Warehouse_NYC             0.0788
 9 Warehouse_SEA             0.103 
10 Warehouse_SF              0.146 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">### low of 8% high of 16%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#if this does nothing, its bc it takes forever to load</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#basically inconclusive, high p values. get rid of it? idk</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Then I changed course for a bit and tried out logistic regression using only the numeric predictors. As expected, Transit Days was highly significant, but I had issues with that (more later). I also found that Distance was significant, but to less of a degree.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>NumReg <span class="ot">&lt;-</span> <span class="fu">glm</span>(D_or_L <span class="sc">~</span> Weight_kg <span class="sc">+</span> Distance_miles <span class="sc">+</span> Cost <span class="sc">+</span> Transit_Days,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> df, <span class="at">family =</span> binomial)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(NumReg) <span class="co">#pval low for transit days(duh) and for distance_miles</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = D_or_L ~ Weight_kg + Distance_miles + Cost + Transit_Days, 
    family = binomial, data = df)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    -3.2603740  0.2053619 -15.876  &lt; 2e-16 ***
Weight_kg      -0.0003136  0.0014098  -0.222    0.824    
Distance_miles -0.0008703  0.0001809  -4.812 1.49e-06 ***
Cost           -0.0003432  0.0009699  -0.354    0.723    
Transit_Days    0.4191621  0.0262958  15.940  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1463.4  on 1923  degrees of freedom
Residual deviance: 1021.2  on 1919  degrees of freedom
AIC: 1031.2

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>Still wondering what was up with UPS, Boston, and NYC, I put the predictors together to see if my answer this time was different.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>AllReg <span class="ot">&lt;-</span> <span class="fu">glm</span>(D_or_L <span class="sc">~</span> Weight_kg <span class="sc">+</span> Distance_miles <span class="sc">+</span> Cost <span class="sc">+</span> Transit_Days <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                           Origin_Warehouse <span class="sc">+</span> Destination <span class="sc">+</span> Carrier <span class="sc">+</span> ShipWeekday,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> df, <span class="at">family =</span> binomial)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(AllReg)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = D_or_L ~ Weight_kg + Distance_miles + Cost + Transit_Days + 
    Origin_Warehouse + Destination + Carrier + ShipWeekday, family = binomial, 
    data = df)

Coefficients:
                                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                   -3.6766846  0.5893865  -6.238 4.43e-10 ***
Weight_kg                     -0.0004018  0.0018193  -0.221   0.8252    
Distance_miles                -0.0009359  0.0001646  -5.684 1.31e-08 ***
Cost                          -0.0001847  0.0007081  -0.261   0.7943    
Transit_Days                   0.4216901  0.0269204  15.664  &lt; 2e-16 ***
Origin_WarehouseWarehouse_BOS -0.0196136  0.3778913  -0.052   0.9586    
Origin_WarehouseWarehouse_CHI -0.1268439  0.3817438  -0.332   0.7397    
Origin_WarehouseWarehouse_DEN  0.0025067  0.3799051   0.007   0.9947    
Origin_WarehouseWarehouse_HOU  0.1671347  0.3605757   0.464   0.6430    
Origin_WarehouseWarehouse_LA  -0.1945669  0.3723975  -0.522   0.6013    
Origin_WarehouseWarehouse_MIA  0.0461490  0.3787269   0.122   0.9030    
Origin_WarehouseWarehouse_NYC -0.5677237  0.4599029  -1.234   0.2170    
Origin_WarehouseWarehouse_SEA -0.3676569  0.4104222  -0.896   0.3704    
Origin_WarehouseWarehouse_SF   0.2037305  0.3569044   0.571   0.5681    
DestinationBoston              0.8393284  0.4946626   1.697   0.0897 .  
DestinationChicago             0.3544202  0.4957359   0.715   0.4746    
DestinationDallas              0.4218152  0.5116634   0.824   0.4097    
DestinationDenver              0.6078049  0.5035219   1.207   0.2274    
DestinationDetroit             0.7157190  0.4816940   1.486   0.1373    
DestinationHouston             0.7599830  0.5033920   1.510   0.1311    
DestinationLos Angeles         0.2525614  0.5452497   0.463   0.6432    
DestinationMiami              -0.0637446  0.5750218  -0.111   0.9117    
DestinationMinneapolis         0.5543726  0.4909515   1.129   0.2588    
DestinationNew York            0.7046304  0.5001089   1.409   0.1588    
DestinationPhoenix             0.2044209  0.4958897   0.412   0.6802    
DestinationPortland            0.5711333  0.4903905   1.165   0.2442    
DestinationSan Francisco       0.4453125  0.5071199   0.878   0.3799    
DestinationSeattle             0.5502214  0.5216724   1.055   0.2916    
CarrierDHL                    -0.3950203  0.3077502  -1.284   0.1993    
CarrierFedEx                  -0.6692550  0.3267052  -2.048   0.0405 *  
CarrierLaserShip              -0.2215526  0.2932277  -0.756   0.4499    
CarrierOnTrac                 -0.6285962  0.3148428  -1.997   0.0459 *  
CarrierUPS                    -0.5936007  0.3316049  -1.790   0.0734 .  
CarrierUSPS                   -0.3143659  0.3095012  -1.016   0.3098    
ShipWeekdayTuesday             0.8048215  0.3379797   2.381   0.0173 *  
ShipWeekdayWednesday           0.4022871  0.3463999   1.161   0.2455    
ShipWeekdayThursday            0.2891490  0.3689413   0.784   0.4332    
ShipWeekdayFriday              0.5009009  0.3424220   1.463   0.1435    
ShipWeekdaySaturday            0.4592029  0.3494373   1.314   0.1888    
ShipWeekdaySunday              0.3090635  0.3664374   0.843   0.3990    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1463.37  on 1923  degrees of freedom
Residual deviance:  993.25  on 1884  degrees of freedom
AIC: 1073.3

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>Curiously, FedEx and OnTrac, two carriers, became significant, but all three other predictors lost their significance with this model. That puzzled me, so I sought to get to the bottom of it with various flags. I included the code, but needless to say, it was a bust, and I gave up trying to use specific carriers and warehouses as anything significant in terms of model impact.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>uglydf<span class="sc">$</span>UPS_flag <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>Carrier <span class="sc">==</span> <span class="st">"UPS"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>uglydf<span class="sc">$</span>NYC_flag <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>Origin_Warehouse <span class="sc">==</span> <span class="st">"Warehouse_NYC"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>uglydf<span class="sc">$</span>Boston_flag <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>Destination <span class="sc">==</span> <span class="st">"Boston"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>uglydf<span class="sc">$</span>Tuesday_flag <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>ShipWeekday <span class="sc">==</span> <span class="st">"Tuesday"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">#testing w another regression w the flagts to see if "rly significant"</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>model_flags <span class="ot">&lt;-</span> <span class="fu">glm</span>(D_or_L <span class="sc">~</span> UPS_flag <span class="sc">+</span> NYC_flag <span class="sc">+</span> Boston_flag <span class="sc">+</span> Tuesday_flag,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> uglydf, <span class="at">family =</span> binomial) </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_flags) <span class="co">#only Boston still significant!?</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Get 95% confidence intervals for these hoes. IF THE LEFT IS OVER 1 OR THE</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">#RIGHT IS UNDER 1 THEN ITS SIGNIFICANT</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(model_flags)) <span class="co">#NYC, Boston</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(AllReg)) <span class="co">#distance, transit days(duh), Tuesday, OnTrac, FedEx</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#yes the results are different; no idk</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Then I tried cross-validating it to see if I could get anything good out of it. I chose 5 folds to make it easy and went for it, using all variables.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2253221</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>cv_ctrl <span class="ot">=</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">5</span>)  <span class="co"># 5-fold CV</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>D_or_L <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>D_or_L)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>cvmodel <span class="ot">=</span> <span class="fu">train</span>(</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  D_or_L <span class="sc">~</span> Weight_kg <span class="sc">+</span> Distance_miles <span class="sc">+</span> Cost <span class="sc">+</span> Transit_Days <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    Origin_Warehouse <span class="sc">+</span> Destination <span class="sc">+</span> Carrier <span class="sc">+</span> ShipWeekday,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"glm"</span>,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> cv_ctrl</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>cvmodel</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized Linear Model 

1924 samples
   8 predictor
   2 classes: '0', '1' 

No pre-processing
Resampling: Cross-Validated (5 fold) 
Summary of sample sizes: 1539, 1539, 1540, 1539, 1539 
Resampling results:

  Accuracy   Kappa    
  0.9246388  0.5730275</code></pre>
</div>
</div>
<p>Accuracy and Kappa were both great, which was nice after the frustrating adventure so far. Realizing the model wasn’t so bad, I ran a stepwise function to see if I could reduce the parameters and keep some accuracy.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>stepmodel <span class="ot">=</span> stats<span class="sc">::</span><span class="fu">step</span>(AllReg_clean, <span class="at">direction =</span> <span class="st">"both"</span>) <span class="do">##############stepwise</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=1073.25
D_or_L ~ Weight_kg + Distance_miles + Cost + Transit_Days + Origin_Warehouse + 
    Destination + Carrier + ShipWeekday</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                   Df Deviance    AIC
- Destination      14  1001.47 1053.5
- Origin_Warehouse  9   998.87 1060.9
- ShipWeekday       6   999.89 1067.9
- Carrier           6  1000.27 1068.3
- Weight_kg         1   993.34 1071.3
- Cost              1   993.35 1071.3
&lt;none&gt;                  993.25 1073.2
- Distance_miles    1  1007.09 1085.1
- Transit_Days      1  1423.65 1501.7

Step:  AIC=1053.47
D_or_L ~ Weight_kg + Distance_miles + Cost + Transit_Days + Origin_Warehouse + 
    Carrier + ShipWeekday</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                   Df Deviance    AIC
- Origin_Warehouse  9  1007.06 1041.1
- ShipWeekday       6  1007.76 1047.8
- Carrier           6  1008.36 1048.4
- Weight_kg         1  1001.53 1051.5
- Cost              1  1001.55 1051.5
&lt;none&gt;                 1001.47 1053.5
- Distance_miles    1  1014.89 1064.9
+ Destination      14   993.25 1073.2
- Transit_Days      1  1435.62 1485.6

Step:  AIC=1041.06
D_or_L ~ Weight_kg + Distance_miles + Cost + Transit_Days + Carrier + 
    ShipWeekday</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                   Df Deviance    AIC
- ShipWeekday       6  1013.20 1035.2
- Carrier           6  1015.09 1037.1
- Weight_kg         1  1007.12 1039.1
- Cost              1  1007.17 1039.2
&lt;none&gt;                 1007.06 1041.1
- Distance_miles    1  1020.27 1052.3
+ Origin_Warehouse  9  1001.47 1053.5
+ Destination      14   998.87 1060.9
- Transit_Days      1  1445.52 1477.5

Step:  AIC=1035.2
D_or_L ~ Weight_kg + Distance_miles + Cost + Transit_Days + Carrier</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                   Df Deviance    AIC
- Carrier           6   1021.2 1031.2
- Weight_kg         1   1013.3 1033.3
- Cost              1   1013.3 1033.3
&lt;none&gt;                  1013.2 1035.2
+ ShipWeekday       6   1007.1 1041.1
- Distance_miles    1   1026.4 1046.4
+ Origin_Warehouse  9   1007.8 1047.8
+ Destination      14   1005.2 1055.2
- Transit_Days      1   1453.2 1473.2

Step:  AIC=1031.2
D_or_L ~ Weight_kg + Distance_miles + Cost + Transit_Days</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                   Df Deviance    AIC
- Weight_kg         1   1021.3 1029.3
- Cost              1   1021.4 1029.4
&lt;none&gt;                  1021.2 1031.2
+ Carrier           6   1013.2 1035.2
+ ShipWeekday       6   1015.1 1037.1
- Distance_miles    1   1032.7 1040.7
+ Origin_Warehouse  9   1014.7 1042.7
+ Destination      14   1013.3 1051.3
- Transit_Days      1   1462.0 1470.0

Step:  AIC=1029.28
D_or_L ~ Distance_miles + Cost + Transit_Days</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                   Df Deviance    AIC
- Cost              1   1021.5 1027.5
&lt;none&gt;                  1021.3 1029.3
+ Weight_kg         1   1021.2 1031.2
+ Carrier           6   1013.3 1033.3
+ ShipWeekday       6   1015.2 1035.2
- Distance_miles    1   1032.7 1038.7
+ Origin_Warehouse  9   1014.8 1040.8
+ Destination      14   1013.4 1049.4
- Transit_Days      1   1462.2 1468.2

Step:  AIC=1027.54
D_or_L ~ Distance_miles + Transit_Days

                   Df Deviance    AIC
&lt;none&gt;                  1021.5 1027.5
+ Cost              1   1021.3 1029.3
+ Weight_kg         1   1021.4 1029.4
+ Carrier           6   1013.4 1031.4
+ ShipWeekday       6   1015.4 1033.4
+ Origin_Warehouse  9   1015.0 1039.0
+ Destination      14   1013.7 1047.7
- Distance_miles    1   1072.8 1076.8
- Transit_Days      1   1462.3 1466.3</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stepmodel)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = D_or_L ~ Distance_miles + Transit_Days, family = binomial, 
    data = df_clean)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    -3.2822669  0.1989169 -16.501  &lt; 2e-16 ***
Distance_miles -0.0009146  0.0001336  -6.847 7.52e-12 ***
Transit_Days    0.4191639  0.0263054  15.935  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1463.4  on 1923  degrees of freedom
Residual deviance: 1021.5  on 1921  degrees of freedom
AIC: 1027.5

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>As the summary says, only two variables are needed in the model, Distance and Transit Days. Therefore, the improved model for predicting package delays and losses would be:</p>
<p><span class="math display">\[
DelayedOrLost = -3.2579491 + .4139328(TransitDays) - .0009309(DistanceMiles)
\]</span></p>
<p>Nice and succinct. However, there’s a problem: of COURSE Transit Days is correlated with there being a delay or loss in package, because being in transit more days and being delayed; it’s a data leakage/target leakage. So, I removed Transit Days from the dataset to try and determine what else might be a significant predictor:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>NoTransit <span class="ot">=</span> <span class="fu">glm</span>(</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  D_or_L <span class="sc">~</span> Weight_kg <span class="sc">+</span> Distance_miles <span class="sc">+</span> Cost <span class="sc">+</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    Origin_Warehouse <span class="sc">+</span> Destination <span class="sc">+</span> Carrier <span class="sc">+</span> ShipWeekday,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(NoTransit)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = D_or_L ~ Weight_kg + Distance_miles + Cost + Origin_Warehouse + 
    Destination + Carrier + ShipWeekday, family = binomial, data = df)

Coefficients:
                                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                   -1.9259749  0.4644150  -4.147 3.37e-05 ***
Weight_kg                     -0.0004024  0.0011434  -0.352   0.7249    
Distance_miles                -0.0001185  0.0001214  -0.976   0.3288    
Cost                          -0.0001349  0.0005149  -0.262   0.7934    
Origin_WarehouseWarehouse_BOS -0.2230949  0.3012779  -0.740   0.4590    
Origin_WarehouseWarehouse_CHI -0.3081609  0.3004967  -1.026   0.3051    
Origin_WarehouseWarehouse_DEN -0.4525677  0.3113866  -1.453   0.1461    
Origin_WarehouseWarehouse_HOU -0.0525546  0.2823104  -0.186   0.8523    
Origin_WarehouseWarehouse_LA  -0.2569495  0.2922122  -0.879   0.3792    
Origin_WarehouseWarehouse_MIA  0.0112593  0.2862008   0.039   0.9686    
Origin_WarehouseWarehouse_NYC -0.7296010  0.3531617  -2.066   0.0388 *  
Origin_WarehouseWarehouse_SEA -0.4820636  0.3170140  -1.521   0.1284    
Origin_WarehouseWarehouse_SF  -0.1249702  0.2827180  -0.442   0.6585    
DestinationBoston              0.9705347  0.3999365   2.427   0.0152 *  
DestinationChicago             0.2202887  0.4162486   0.529   0.5967    
DestinationDallas              0.3253840  0.4241059   0.767   0.4429    
DestinationDenver              0.2304620  0.4265147   0.540   0.5890    
DestinationDetroit             0.7392355  0.3943055   1.875   0.0608 .  
DestinationHouston             0.4693084  0.4241306   1.107   0.2685    
DestinationLos Angeles         0.4305887  0.4231828   1.018   0.3089    
DestinationMiami               0.1143389  0.4511480   0.253   0.7999    
DestinationMinneapolis         0.4061410  0.4079814   0.995   0.3195    
DestinationNew York            0.7006087  0.4111125   1.704   0.0883 .  
DestinationPhoenix             0.4578117  0.4047136   1.131   0.2580    
DestinationPortland            0.3942995  0.4123233   0.956   0.3389    
DestinationSan Francisco       0.4103794  0.4229328   0.970   0.3319    
DestinationSeattle             0.6015329  0.4254087   1.414   0.1574    
CarrierDHL                    -0.2182461  0.2418029  -0.903   0.3667    
CarrierFedEx                  -0.4542240  0.2535636  -1.791   0.0732 .  
CarrierLaserShip              -0.4174996  0.2449453  -1.704   0.0883 .  
CarrierOnTrac                 -0.4823652  0.2500167  -1.929   0.0537 .  
CarrierUPS                    -0.6526544  0.2738680  -2.383   0.0172 *  
CarrierUSPS                   -0.4238265  0.2504424  -1.692   0.0906 .  
ShipWeekdayTuesday             0.6272827  0.2711027   2.314   0.0207 *  
ShipWeekdayWednesday           0.2309549  0.2810250   0.822   0.4112    
ShipWeekdayThursday            0.1994561  0.2932497   0.680   0.4964    
ShipWeekdayFriday              0.5233315  0.2724820   1.921   0.0548 .  
ShipWeekdaySaturday            0.3529686  0.2800912   1.260   0.2076    
ShipWeekdaySunday              0.3352959  0.2870846   1.168   0.2428    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1463.4  on 1923  degrees of freedom
Residual deviance: 1423.6  on 1885  degrees of freedom
AIC: 1501.6

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>And ran a cross-validation, with necessary data-wrangling to make it work:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2253221</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>NOTRANSIT.ctrl <span class="ot">=</span> <span class="fu">trainControl</span>(</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"cv"</span>,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="dv">8</span>,       </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">sampling =</span> <span class="st">"up"</span>,     </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">savePredictions =</span> <span class="st">"final"</span>,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">classProbs =</span> <span class="cn">TRUE</span>,   <span class="co">#lets me do other stuff idk</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co">#aside stuff so the cv model works</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>uglydf<span class="sc">$</span>D_or_L <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>D_or_L)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>uglydf<span class="sc">$</span>D_or_L[df<span class="sc">$</span>D_or_L <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="dv">0</span>)] <span class="ot">&lt;-</span> <span class="st">"OnTime"</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>uglydf<span class="sc">$</span>D_or_L[df<span class="sc">$</span>D_or_L <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="dv">1</span>)] <span class="ot">&lt;-</span> <span class="st">"Delayed"</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>NOTRANSIT.cvmodel <span class="ot">=</span> <span class="fu">train</span>(</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  D_or_L <span class="sc">~</span> Weight_kg <span class="sc">+</span> Distance_miles <span class="sc">+</span> Cost <span class="sc">+</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>    Origin_Warehouse <span class="sc">+</span> Destination <span class="sc">+</span> Carrier <span class="sc">+</span> ShipWeekday,</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> uglydf, <span class="do">#############################################</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"glm"</span>,</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> NOTRANSIT.ctrl</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>NOTRANSIT.cvmodel </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized Linear Model 

1924 samples
   7 predictor
   2 classes: 'Delayed', 'OnTime' 

No pre-processing
Resampling: Cross-Validated (8 fold) 
Summary of sample sizes: 1683, 1683, 1684, 1683, 1684, 1683, ... 
Addtional sampling using up-sampling

Resampling results:

  Accuracy   Kappa      
  0.5535313  0.004961356</code></pre>
</div>
</div>
<p>As you can see, the accuracy is <em>way</em> down compared to the model that included Transit Days. A meager 55% is looking very bleak. I ran the step-wise again to make sure my sinking suspicions were correct:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>stepNOTRANSIT <span class="ot">=</span> stats<span class="sc">::</span><span class="fu">step</span>(NoTransit, <span class="at">direction =</span> <span class="st">"both"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=1501.65
D_or_L ~ Weight_kg + Distance_miles + Cost + Origin_Warehouse + 
    Destination + Carrier + ShipWeekday

                   Df Deviance    AIC
- Destination      14   1435.6 1485.6
- Origin_Warehouse  9   1432.8 1492.8
- ShipWeekday       6   1431.2 1497.2
- Carrier           6   1431.5 1497.5
- Cost              1   1423.7 1499.7
- Weight_kg         1   1423.9 1499.9
- Distance_miles    1   1424.4 1500.4
&lt;none&gt;                  1423.7 1501.7

Step:  AIC=1485.62
D_or_L ~ Weight_kg + Distance_miles + Cost + Origin_Warehouse + 
    Carrier + ShipWeekday

                   Df Deviance    AIC
- Origin_Warehouse  9   1445.5 1477.5
- ShipWeekday       6   1443.4 1481.4
- Carrier           6   1444.2 1482.2
- Cost              1   1435.7 1483.7
- Weight_kg         1   1435.7 1483.7
- Distance_miles    1   1436.2 1484.2
&lt;none&gt;                  1435.6 1485.6
+ Destination      14   1423.7 1501.7

Step:  AIC=1477.52
D_or_L ~ Weight_kg + Distance_miles + Cost + Carrier + ShipWeekday

                   Df Deviance    AIC
- ShipWeekday       6   1453.2 1473.2
- Carrier           6   1454.4 1474.4
- Cost              1   1445.5 1475.5
- Weight_kg         1   1445.6 1475.6
- Distance_miles    1   1446.1 1476.1
&lt;none&gt;                  1445.5 1477.5
+ Origin_Warehouse  9   1435.6 1485.6
+ Destination      14   1432.8 1492.8

Step:  AIC=1473.15
D_or_L ~ Weight_kg + Distance_miles + Cost + Carrier

                   Df Deviance    AIC
- Carrier           6   1462.0 1470.0
- Cost              1   1453.2 1471.2
- Weight_kg         1   1453.3 1471.3
- Distance_miles    1   1453.7 1471.7
&lt;none&gt;                  1453.2 1473.2
+ ShipWeekday       6   1445.5 1477.5
+ Origin_Warehouse  9   1443.4 1481.4
+ Destination      14   1440.2 1488.2

Step:  AIC=1470.03
D_or_L ~ Weight_kg + Distance_miles + Cost

                   Df Deviance    AIC
- Cost              1   1462.1 1468.1
- Weight_kg         1   1462.2 1468.2
- Distance_miles    1   1462.5 1468.5
&lt;none&gt;                  1462.0 1470.0
+ Carrier           6   1453.2 1473.2
+ ShipWeekday       6   1454.4 1474.4
+ Origin_Warehouse  9   1452.0 1478.0
+ Destination      14   1448.4 1484.4

Step:  AIC=1468.14
D_or_L ~ Weight_kg + Distance_miles

                   Df Deviance    AIC
- Weight_kg         1   1462.3 1466.3
- Distance_miles    1   1463.2 1467.2
&lt;none&gt;                  1462.1 1468.1
+ Cost              1   1462.0 1470.0
+ Carrier           6   1453.2 1471.2
+ ShipWeekday       6   1454.5 1472.5
+ Origin_Warehouse  9   1452.1 1476.1
+ Destination      14   1448.6 1482.6

Step:  AIC=1466.31
D_or_L ~ Distance_miles

                   Df Deviance    AIC
- Distance_miles    1   1463.4 1465.4
&lt;none&gt;                  1462.3 1466.3
+ Weight_kg         1   1462.1 1468.1
+ Cost              1   1462.2 1468.2
+ Carrier           6   1453.3 1469.3
+ ShipWeekday       6   1454.6 1470.6
+ Origin_Warehouse  9   1452.3 1474.3
+ Destination      14   1448.9 1480.9

Step:  AIC=1465.37
D_or_L ~ 1

                   Df Deviance    AIC
&lt;none&gt;                  1463.4 1465.4
+ Distance_miles    1   1462.3 1466.3
+ Cost              1   1462.6 1466.6
+ Weight_kg         1   1463.2 1467.2
+ Carrier           6   1454.6 1468.6
+ ShipWeekday       6   1455.6 1469.6
+ Origin_Warehouse  9   1453.5 1473.5
+ Destination      14   1450.4 1480.4</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stepNOTRANSIT) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = D_or_L ~ 1, family = binomial, data = df)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -1.92938    0.06851  -28.16   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1463.4  on 1923  degrees of freedom
Residual deviance: 1463.4  on 1923  degrees of freedom
AIC: 1465.4

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>Yup. Not a single variable makes it to the final model—nothing is significant, and it’s a wash. Therefore, regardless of the integrity of keeping data leakage in the model, that’s our best bet we can achieve with logistic regression. So, let’s have a hack at something else: LDA</p>
</section>
<section id="linear-discriminant-analysis" class="level2">
<h2 class="anchored" data-anchor-id="linear-discriminant-analysis">Linear Discriminant Analysis</h2>
<p>I unfortunately had to run it manually since every single regular method wasn’t working properly due to package issues. The code is 141 lines so I’m hiding it, but here’s the output:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS) <span class="co"># For lda()</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC) <span class="co"># For roc()</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co"># --- PASTE THIS CHUNK *BEFORE* YOUR CV LOOP ---</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Dummy-code categoricals</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>dmy <span class="ot">=</span> <span class="fu">dummyVars</span>(<span class="sc">~</span> Origin_Warehouse <span class="sc">+</span> Destination <span class="sc">+</span> Carrier <span class="sc">+</span> ShipWeekday,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> df, <span class="at">fullRank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>Xcat <span class="ot">=</span> <span class="fu">predict</span>(dmy, <span class="at">newdata =</span> df)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Assemble modeling frame</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>df_lda <span class="ot">=</span> <span class="fu">cbind</span>(</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">D_or_L =</span> df<span class="sc">$</span>D_or_L,</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Weight_kg =</span> df<span class="sc">$</span>Weight_kg,</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Distance_miles =</span> df<span class="sc">$</span>Distance_miles,</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cost =</span> df<span class="sc">$</span>Cost,</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  Xcat</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>df_lda <span class="ot">=</span> <span class="fu">as.data.frame</span>(df_lda)</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>df_lda <span class="ot">=</span> <span class="fu">na.omit</span>(df_lda)</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Normalize target labels for LDA</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>df_lda<span class="sc">$</span>D_or_L <span class="ot">=</span> <span class="fu">as.character</span>(df_lda<span class="sc">$</span>D_or_L)</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>df_lda<span class="sc">$</span>D_or_L[df_lda<span class="sc">$</span>D_or_L <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"2"</span>, <span class="dv">2</span>, <span class="st">"Lost"</span>, <span class="st">"Delayed/Lost"</span>, <span class="st">"Delayed"</span>)] <span class="ot">=</span> <span class="st">"Delayed"</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>df_lda<span class="sc">$</span>D_or_L[df_lda<span class="sc">$</span>D_or_L <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="dv">1</span>, <span class="st">"OnTime"</span>, <span class="st">"on time"</span>, <span class="st">"ontime"</span>)] <span class="ot">=</span> <span class="st">"OnTime"</span></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>df_lda<span class="sc">$</span>D_or_L <span class="ot">=</span> <span class="fu">factor</span>(df_lda<span class="sc">$</span>D_or_L, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Delayed"</span>, <span class="st">"OnTime"</span>))</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Assign prior probabilities</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>lda_prior <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>) </span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(lda_prior) <span class="ot">=</span> <span class="fu">levels</span>(df_lda<span class="sc">$</span>D_or_L) </span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a><span class="co"># --- </span><span class="re">END</span><span class="co"> OF PREP CHUNK ---</span></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2253221</span>)</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>k_folds <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Create fold assignments</span></span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">cut</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(df_lda)), <span class="at">breaks =</span> k_folds, <span class="at">labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly shuffle the assignments</span></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">sample</span>(folds) </span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame to store the metrics from each fold</span></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a><span class="co"># --- UPDATED to include Accuracy and Kappa ---</span></span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>all_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">ROC =</span> <span class="fu">numeric</span>(), </span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sens =</span> <span class="fu">numeric</span>(), </span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">Spec =</span> <span class="fu">numeric</span>(),</span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">Accuracy =</span> <span class="fu">numeric</span>(),</span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">Kappa =</span> <span class="fu">numeric</span>()</span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Starting manual 8-fold CV for LDA..."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Starting manual 8-fold CV for LDA..."</code></pre>
</div>
<details class="code-fold">
<summary>Show R Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Start the CV loop ---</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k_folds) {</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. Split data into training and testing</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  test_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(folds <span class="sc">==</span> i)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  test_data <span class="ot">&lt;-</span> df_lda[test_indices, ]</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  train_data <span class="ot">&lt;-</span> df_lda[<span class="sc">-</span>test_indices, ]</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. Fit the LDA model directly (no caret)</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  lda_fit <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">lda</span>(</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    D_or_L <span class="sc">~</span> ., </span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> train_data,</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> lda_prior </span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. Predict on the test data</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  lda_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(lda_fit, <span class="at">newdata =</span> test_data)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Calculate Metrics Manually ---</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (Skip fold if test set doesn't have both classes)</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">unique</span>(test_data<span class="sc">$</span>D_or_L)) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>    all_metrics[i, ] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span> </span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. ROC/AUC (from pROC)</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>  roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">response =</span> test_data<span class="sc">$</span>D_or_L,</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">predictor =</span> lda_pred<span class="sc">$</span>posterior[, <span class="st">"Delayed"</span>], <span class="co"># Probability of "Delayed"</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"OnTime"</span>, <span class="st">"Delayed"</span>)</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. Confusion Matrix components</span></span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>  conf_table <span class="ot">&lt;-</span> <span class="fu">table</span>(</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">Predicted =</span> lda_pred<span class="sc">$</span>class, </span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">Actual =</span> test_data<span class="sc">$</span>D_or_L</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- (Safeguard for 2x2 table) ---</span></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"Delayed"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(conf_table))) { conf_table <span class="ot">&lt;-</span> <span class="fu">rbind</span>(conf_table, <span class="st">"Delayed"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) }</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"OnTime"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(conf_table))) { conf_table <span class="ot">&lt;-</span> <span class="fu">rbind</span>(conf_table, <span class="st">"OnTime"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) }</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"Delayed"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(conf_table))) { conf_table <span class="ot">&lt;-</span> <span class="fu">cbind</span>(conf_table, <span class="st">"Delayed"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) }</span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"OnTime"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(conf_table))) { conf_table <span class="ot">&lt;-</span> <span class="fu">cbind</span>(conf_table, <span class="st">"OnTime"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) }</span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>  conf_table <span class="ot">&lt;-</span> conf_table[<span class="fu">c</span>(<span class="st">"Delayed"</span>, <span class="st">"OnTime"</span>), <span class="fu">c</span>(<span class="st">"Delayed"</span>, <span class="st">"OnTime"</span>)]</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- (End Safeguard) ---</span></span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Your positive class is "Delayed"</span></span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>  TP <span class="ot">&lt;-</span> conf_table[<span class="st">"Delayed"</span>, <span class="st">"Delayed"</span>] <span class="co"># True Positive</span></span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>  FN <span class="ot">&lt;-</span> conf_table[<span class="st">"OnTime"</span>, <span class="st">"Delayed"</span>]  <span class="co"># False Negative</span></span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>  TN <span class="ot">&lt;-</span> conf_table[<span class="st">"OnTime"</span>, <span class="st">"OnTime"</span>]   <span class="co"># True Negative</span></span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>  FP <span class="ot">&lt;-</span> conf_table[<span class="st">"Delayed"</span>, <span class="st">"OnTime"</span>]  <span class="co"># False Positive</span></span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a>  Sens <span class="ot">&lt;-</span> TP <span class="sc">/</span> (TP <span class="sc">+</span> FN)</span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a>  Spec <span class="ot">&lt;-</span> TN <span class="sc">/</span> (TN <span class="sc">+</span> FP)</span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- NEW: Calculate Accuracy and Kappa ---</span></span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a>  Total <span class="ot">&lt;-</span> TP <span class="sc">+</span> FN <span class="sc">+</span> TN <span class="sc">+</span> FP</span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Accuracy</span></span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a>  Accuracy <span class="ot">&lt;-</span> (TP <span class="sc">+</span> TN) <span class="sc">/</span> Total</span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Kappa</span></span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># P_o (observed agreement) is just Accuracy</span></span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># P_e (expected agreement)</span></span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a>  prob_actual_delayed <span class="ot">&lt;-</span> (TP <span class="sc">+</span> FN) <span class="sc">/</span> Total</span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a>  prob_actual_ontime  <span class="ot">&lt;-</span> (FP <span class="sc">+</span> TN) <span class="sc">/</span> Total</span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a>  prob_pred_delayed   <span class="ot">&lt;-</span> (TP <span class="sc">+</span> FP) <span class="sc">/</span> Total</span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a>  prob_pred_ontime    <span class="ot">&lt;-</span> (FN <span class="sc">+</span> TN) <span class="sc">/</span> Total</span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a>  prob_e <span class="ot">&lt;-</span> (prob_actual_delayed <span class="sc">*</span> prob_pred_delayed) <span class="sc">+</span> (prob_actual_ontime <span class="sc">*</span> prob_pred_ontime)</span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a>  Kappa <span class="ot">&lt;-</span> (Accuracy <span class="sc">-</span> prob_e) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> prob_e)</span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- (End New) ---</span></span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store all metrics for this fold</span></span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a>  all_metrics[i, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">as.numeric</span>(roc_obj<span class="sc">$</span>auc), Sens, Spec, Accuracy, Kappa)</span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases
Setting direction: controls &lt; cases
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<details class="code-fold">
<summary>Show R Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- End of loop ---</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Get your final, averaged results</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"--- Manual CV Results ---"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "--- Manual CV Results ---"</code></pre>
</div>
<details class="code-fold">
<summary>Show R Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">colMeans</span>(all_metrics, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       ROC       Sens       Spec   Accuracy      Kappa 
0.52689391 0.43525482 0.58462636 0.56756354 0.01199168 </code></pre>
</div>
</div>
<p>All three results are pretty trash and unreliable, frankly. And this was AFTER upsampling. Terrible accuracy, and specificity and sensitivity are nothing at all to write home about. Not that that’s too surprising—LDA, being classification, probably was never a good bet for a dataset like this where categories are so disparate in size, &gt;1600 to &lt;100.</p>
<p>Additionally, the LDA’s low ROC score indicates that the relationship between the predictors (e.g., carrier, distance, cost) and a package delay is not simple or linear.</p>
<p>Instead of trying to play with the LDA model over and over to make it work, I moved on to something else, that proved more reliable: random forests.</p>
</section>
<section id="random-forest" class="level2">
<h2 class="anchored" data-anchor-id="random-forest">Random Forest</h2>
<p>I had to clean up the data again to make it work, which is below. How it takes response variables is different from LDA so it needed changed again.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>D_or_L <span class="ot">=</span> <span class="fu">as.character</span>(df<span class="sc">$</span>D_or_L)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>D_or_L[df<span class="sc">$</span>D_or_L <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="dv">1</span>, <span class="st">"Delayed"</span>, <span class="st">"Lost"</span>, <span class="st">"Delayed/Lost"</span>)] <span class="ot">=</span> <span class="st">"Delayed"</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>D_or_L[df<span class="sc">$</span>D_or_L <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="dv">0</span>, <span class="st">"OnTime"</span>, <span class="st">"on time"</span>, <span class="st">"ontime"</span>)] <span class="ot">=</span> <span class="st">"OnTime"</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>D_or_L <span class="ot">=</span> <span class="fu">factor</span>(df<span class="sc">$</span>D_or_L, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Delayed"</span>, <span class="st">"OnTime"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Then I made a control and ran the tree:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2253221</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>rf_ctrl <span class="ot">=</span> <span class="fu">trainControl</span>(</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"cv"</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="dv">8</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sampling =</span> <span class="st">"up"</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">summaryFunction =</span> twoClassSummary,</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">savePredictions =</span> <span class="st">"final"</span>,</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">verboseIter =</span> <span class="cn">TRUE</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="co">#train RF</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">=</span> <span class="fu">train</span>(</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>  D_or_L <span class="sc">~</span> Weight_kg <span class="sc">+</span> Distance_miles <span class="sc">+</span> Cost <span class="sc">+</span> Transit_Days <span class="sc">+</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>    Origin_Warehouse <span class="sc">+</span> Destination <span class="sc">+</span> Carrier <span class="sc">+</span> ShipWeekday,</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df,</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"ROC"</span>,</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> rf_ctrl,</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneLength =</span> <span class="dv">5</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>+ Fold1: mtry= 2 
- Fold1: mtry= 2 
+ Fold1: mtry=11 
- Fold1: mtry=11 
+ Fold1: mtry=20 
- Fold1: mtry=20 
+ Fold1: mtry=29 
- Fold1: mtry=29 
+ Fold1: mtry=39 
- Fold1: mtry=39 
+ Fold2: mtry= 2 
- Fold2: mtry= 2 
+ Fold2: mtry=11 
- Fold2: mtry=11 
+ Fold2: mtry=20 
- Fold2: mtry=20 
+ Fold2: mtry=29 
- Fold2: mtry=29 
+ Fold2: mtry=39 
- Fold2: mtry=39 
+ Fold3: mtry= 2 
- Fold3: mtry= 2 
+ Fold3: mtry=11 
- Fold3: mtry=11 
+ Fold3: mtry=20 
- Fold3: mtry=20 
+ Fold3: mtry=29 
- Fold3: mtry=29 
+ Fold3: mtry=39 
- Fold3: mtry=39 
+ Fold4: mtry= 2 
- Fold4: mtry= 2 
+ Fold4: mtry=11 
- Fold4: mtry=11 
+ Fold4: mtry=20 
- Fold4: mtry=20 
+ Fold4: mtry=29 
- Fold4: mtry=29 
+ Fold4: mtry=39 
- Fold4: mtry=39 
+ Fold5: mtry= 2 
- Fold5: mtry= 2 
+ Fold5: mtry=11 
- Fold5: mtry=11 
+ Fold5: mtry=20 
- Fold5: mtry=20 
+ Fold5: mtry=29 
- Fold5: mtry=29 
+ Fold5: mtry=39 
- Fold5: mtry=39 
+ Fold6: mtry= 2 
- Fold6: mtry= 2 
+ Fold6: mtry=11 
- Fold6: mtry=11 
+ Fold6: mtry=20 
- Fold6: mtry=20 
+ Fold6: mtry=29 
- Fold6: mtry=29 
+ Fold6: mtry=39 
- Fold6: mtry=39 
+ Fold7: mtry= 2 
- Fold7: mtry= 2 
+ Fold7: mtry=11 
- Fold7: mtry=11 
+ Fold7: mtry=20 
- Fold7: mtry=20 
+ Fold7: mtry=29 
- Fold7: mtry=29 
+ Fold7: mtry=39 
- Fold7: mtry=39 
+ Fold8: mtry= 2 
- Fold8: mtry= 2 
+ Fold8: mtry=11 
- Fold8: mtry=11 
+ Fold8: mtry=20 
- Fold8: mtry=20 
+ Fold8: mtry=29 
- Fold8: mtry=29 
+ Fold8: mtry=39 
- Fold8: mtry=39 
Aggregating results
Selecting tuning parameters
Fitting mtry = 20 on full training set</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>rf_model</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest 

1924 samples
   8 predictor
   2 classes: 'Delayed', 'OnTime' 

No pre-processing
Resampling: Cross-Validated (8 fold) 
Summary of sample sizes: 1683, 1683, 1684, 1683, 1684, 1683, ... 
Addtional sampling using up-sampling

Resampling results across tuning parameters:

  mtry  ROC        Sens       Spec     
   2    0.8158906  0.5986559  0.9601190
  11    0.8421694  0.6071237  0.9821429
  20    0.8501667  0.6239247  0.9791667
  29    0.8420536  0.6278226  0.9755952
  39    0.8415671  0.6237903  0.9738095

ROC was used to select the optimal model using the largest value.
The final value used for the model was mtry = 20.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rf_model)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Package-Delay-Report_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I tuned the random forest model across 5 different values for the mtry hyperparameter, which controls the number of variables considered at each split. The 8-fold cross-validation determined that an mtry of 20 provided the optimal balance, given that it yielded the highest ROC score.</p>
<p>I also ran the tree, but measuring for accuracy/kappa instead of ROC/sens/spec:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2253221</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>rf_ctrl <span class="ot">=</span> <span class="fu">trainControl</span>(</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"cv"</span>,</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="dv">8</span>,</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sampling =</span> <span class="st">"up"</span>,</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">summaryFunction =</span> twoClassSummary,</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">savePredictions =</span> <span class="st">"final"</span>,</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">verboseIter =</span> <span class="cn">TRUE</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="co">#train RF</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">=</span> <span class="fu">train</span>(</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>  D_or_L <span class="sc">~</span> Weight_kg <span class="sc">+</span> Distance_miles <span class="sc">+</span> Cost <span class="sc">+</span> Transit_Days <span class="sc">+</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>    Origin_Warehouse <span class="sc">+</span> Destination <span class="sc">+</span> Carrier <span class="sc">+</span> ShipWeekday,</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df,</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"ROC"</span>,</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> rf_ctrl,</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneLength =</span> <span class="dv">5</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>+ Fold1: mtry= 2 
- Fold1: mtry= 2 
+ Fold1: mtry=11 
- Fold1: mtry=11 
+ Fold1: mtry=20 
- Fold1: mtry=20 
+ Fold1: mtry=29 
- Fold1: mtry=29 
+ Fold1: mtry=39 
- Fold1: mtry=39 
+ Fold2: mtry= 2 
- Fold2: mtry= 2 
+ Fold2: mtry=11 
- Fold2: mtry=11 
+ Fold2: mtry=20 
- Fold2: mtry=20 
+ Fold2: mtry=29 
- Fold2: mtry=29 
+ Fold2: mtry=39 
- Fold2: mtry=39 
+ Fold3: mtry= 2 
- Fold3: mtry= 2 
+ Fold3: mtry=11 
- Fold3: mtry=11 
+ Fold3: mtry=20 
- Fold3: mtry=20 
+ Fold3: mtry=29 
- Fold3: mtry=29 
+ Fold3: mtry=39 
- Fold3: mtry=39 
+ Fold4: mtry= 2 
- Fold4: mtry= 2 
+ Fold4: mtry=11 
- Fold4: mtry=11 
+ Fold4: mtry=20 
- Fold4: mtry=20 
+ Fold4: mtry=29 
- Fold4: mtry=29 
+ Fold4: mtry=39 
- Fold4: mtry=39 
+ Fold5: mtry= 2 
- Fold5: mtry= 2 
+ Fold5: mtry=11 
- Fold5: mtry=11 
+ Fold5: mtry=20 
- Fold5: mtry=20 
+ Fold5: mtry=29 
- Fold5: mtry=29 
+ Fold5: mtry=39 
- Fold5: mtry=39 
+ Fold6: mtry= 2 
- Fold6: mtry= 2 
+ Fold6: mtry=11 
- Fold6: mtry=11 
+ Fold6: mtry=20 
- Fold6: mtry=20 
+ Fold6: mtry=29 
- Fold6: mtry=29 
+ Fold6: mtry=39 
- Fold6: mtry=39 
+ Fold7: mtry= 2 
- Fold7: mtry= 2 
+ Fold7: mtry=11 
- Fold7: mtry=11 
+ Fold7: mtry=20 
- Fold7: mtry=20 
+ Fold7: mtry=29 
- Fold7: mtry=29 
+ Fold7: mtry=39 
- Fold7: mtry=39 
+ Fold8: mtry= 2 
- Fold8: mtry= 2 
+ Fold8: mtry=11 
- Fold8: mtry=11 
+ Fold8: mtry=20 
- Fold8: mtry=20 
+ Fold8: mtry=29 
- Fold8: mtry=29 
+ Fold8: mtry=39 
- Fold8: mtry=39 
Aggregating results
Selecting tuning parameters
Fitting mtry = 20 on full training set</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>rf_model</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest 

1924 samples
   8 predictor
   2 classes: 'Delayed', 'OnTime' 

No pre-processing
Resampling: Cross-Validated (8 fold) 
Summary of sample sizes: 1683, 1683, 1684, 1683, 1684, 1683, ... 
Addtional sampling using up-sampling

Resampling results across tuning parameters:

  mtry  ROC        Sens       Spec     
   2    0.8158906  0.5986559  0.9601190
  11    0.8421694  0.6071237  0.9821429
  20    0.8501667  0.6239247  0.9791667
  29    0.8420536  0.6278226  0.9755952
  39    0.8415671  0.6237903  0.9738095

ROC was used to select the optimal model using the largest value.
The final value used for the model was mtry = 20.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rf_model)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Package-Delay-Report_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The accuracy was .91 here, which isn’t bad at all honestly. Others on Kaggle only managed .85 or so after making efforts with pruning to improve the confusion matrix, so I’m happy with my result.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">varImp</span>(rf_model)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>rf variable importance

  only 20 most important variables shown (out of 39)

                               Overall
Transit_Days                  100.0000
Distance_miles                 23.6164
Cost                           20.9209
Weight_kg                      18.3046
CarrierUSPS                     2.5001
ShipWeekdayTuesday              1.6583
DestinationSeattle              1.2924
ShipWeekdaySaturday             1.2631
DestinationBoston               1.2341
ShipWeekdaySunday               1.1194
ShipWeekdayFriday               1.0548
Origin_WarehouseWarehouse_BOS   0.9347
ShipWeekdayWednesday            0.9049
Origin_WarehouseWarehouse_DEN   0.8549
DestinationDenver               0.8041
DestinationPortland             0.7939
Origin_WarehouseWarehouse_HOU   0.7662
Origin_WarehouseWarehouse_SF    0.7031
CarrierFedEx                    0.6917
DestinationDetroit              0.6807</code></pre>
</div>
</div>
<p>The ROC is much better at .85, and sensitivity is promising at .62. This means that of all the packages that were actually delayed, we successfully caught 62% of them. The model has a super high specificity of .98 as well, which means it’s extremely accurate at not flagging on-time packages, with a 98% success rate. This ensures operational resources aren’t wasted on false alarms.</p>
<p>Also, looking at variable importance we find that Transit Days is in the far lead, with the other three numeric variables (Distance, Cost, and Weight) lagging behind but still noticeable, and all of the categorical variables far from significant.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Synthesizing the results of the three models, wherein with logistic regression stepwise we discovered Transit Days and Distance were only significant predictors, LDA where the whole thing was a wash, and random forest where Transit Days, Distance, Cost, and Weight all looked fairly significant, we can end with the consideration that Transit Days and Distance are the only two predictors we should really consider in a reduced-yet-still-efficient model.</p>
<p>Of course, there’s still the problem with Transit Days being a target leakage, which frankly reduces the utility of this dataset into nothingness. Which, to be fair, makes sense—people work very hard to make sure packages come, and come quick, so that delays and losses isn’t actually tied to anything makes sense. People working in supply chain and logistics would have already made sure to address an issue if there was one, meaning it makes sense that delay/loss in packages, when omitting the Transit Days variable, is up to random chance. In other words, preventing package delays seems to have already been fully optimized, at least according to the delay at hand.</p>
<p>This should, of course, be celebrated. Though it certainly made this analysis frustrating, the best thing you can do is find no problems or weak areas, which is exactly what happened.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>